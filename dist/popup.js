function loadFlashcards(){console.log("Loading flashcards..."),chrome.storage.local.get("vocabList",(e=>{console.log("Vocab data:",e);const t=e.vocabList||[],n=document.getElementById("vocab-container");n&&(0!==t.length?(n.innerHTML="",t.reverse().forEach(((e,t)=>{console.log("Processing flashcard entry:",e);const a=document.createElement("div");a.className="yomisaver-vocab-entry",a.innerHTML=`\n                <div class="vocab-header">\n                    <input type="checkbox" class="select-flashcard" data-index="${t}">\n                    <div class="word-info">\n                        <h3>${e.word}</h3>\n                        ${e.reading?`<p class="reading">${e.reading}</p>`:""}\n                    </div>\n                    <button class="delete-vocab" title="Delete flashcard">\n                        <svg viewBox="0 0 24 24" width="16" height="16">\n                            <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>\n                        </svg>\n                    </button>\n                </div>\n                ${e.wordInfo?.meanings?.map((e=>`<div class="meaning">${e.definitions.join("; ")}</div>`)).join("")||""}\n                ${e.wordInfo?.jlpt?.length?`<div class="jlpt">${e.wordInfo.jlpt.join(", ").toUpperCase()}</div>`:""}\n            `,a.querySelector(".delete-vocab").addEventListener("click",(()=>{chrome.storage.local.get("vocabList",(e=>{const o=e.vocabList.filter(((e,n)=>n!==t));chrome.storage.local.set({vocabList:o},(()=>{a.remove(),0===o.length&&(n.innerHTML='<p class="yomisaver-coming-soon">No flashcards saved yet!</p>')}))}))})),n.appendChild(a)}))):n.innerHTML='<p class="yomisaver-coming-soon">No flashcards saved yet!</p>')}))}function exportFlashcards(){chrome.storage.local.get("vocabList",(e=>{const t=e.vocabList||[],n=Array.from(document.querySelectorAll(".select-flashcard:checked")).map((e=>parseInt(e.dataset.index))).map((e=>t[e]));if(0===n.length)return void alert("No flashcards selected for export.");const a=n.map((e=>`${e.word}\t${`\n                ${e.reading?`<div>Reading: ${e.reading}</div>`:""}\n                ${e.wordInfo?.meanings?.map((e=>`<div>Definition: ${e.definitions.join("; ")}</div>`)).join("")||""}\n                ${e.wordInfo?.jlpt?.length?`<div>JLPT: ${e.wordInfo.jlpt.join(", ").toUpperCase()}</div>`:""}\n            `.trim().replace(/\n\s+/g," ")}\t${e.wordInfo?.jlpt?.join(" ")||""}`)).join("\n"),o=new Blob([a],{type:"text/tab-separated-values"}),s=URL.createObjectURL(o),d=document.createElement("a");d.href=s,d.download="flashcards.txt",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(s)}))}document.addEventListener("DOMContentLoaded",(()=>{function e(e){console.log(e);const t=document.getElementById("debug");t&&(t.textContent+=e+"\n")}console.log("Popup script loaded"),document.querySelectorAll(".yomisaver-tab-content:not(#flashcards)").forEach((e=>{e.classList.add("hidden")})),document.querySelectorAll(".yomisaver-tab").forEach((t=>{e("Found tab: "+t.dataset.tab),t.addEventListener("click",(()=>{e("Tab clicked: "+t.dataset.tab),!document.getElementById("acknowledgements").classList.contains("hidden")&&(document.getElementById("acknowledgements").classList.add("hidden"),document.getElementById("settings").classList.remove("hidden")),document.querySelectorAll(".yomisaver-tab-content").forEach((e=>{e.classList.remove("active"),e.classList.add("hidden")})),document.querySelectorAll(".yomisaver-tab").forEach((e=>{e.classList.remove("active")}));const n=t.dataset.tab,a=document.getElementById(n);a.classList.remove("hidden"),a.classList.add("active"),t.classList.add("active")}))})),loadFlashcards();const t=document.getElementById("popupSize"),n=document.getElementById("fontSize");function a(e){const t=e/100;chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.sendMessage(e[0].id,{action:"updatePopupSize",size:t})}))}function o(e){const t=e/100;chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.sendMessage(e[0].id,{action:"updateFontSize",size:t})}))}t.addEventListener("input",(e=>{a(e.target.value)})),n.addEventListener("input",(e=>{o(e.target.value)})),t.addEventListener("change",(e=>{chrome.storage.sync.set({popupSize:e.target.value})})),n.addEventListener("change",(e=>{chrome.storage.sync.set({fontSize:e.target.value})}));const s=document.getElementById("toggleFurigana");s.addEventListener("click",(()=>{chrome.storage.sync.get("furiganaVisible",(e=>{const t=!e.furiganaVisible;chrome.storage.sync.set({furiganaVisible:t},(()=>{s.textContent=t?"Hide Furigana":"Show Furigana",chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.sendMessage(e[0].id,{action:"toggleFurigana",visible:t})}))}))}))})),chrome.storage.sync.get(["popupSize","fontSize","furiganaVisible"],(e=>{e.popupSize&&(t.value=e.popupSize,a(e.popupSize)),e.fontSize&&(n.value=e.fontSize,o(e.fontSize)),void 0!==e.furiganaVisible&&(s.textContent=e.furiganaVisible?"Hide Furigana":"Show Furigana",chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{action:"toggleFurigana",visible:e.furiganaVisible})})))})),document.getElementById("export-flashcards").addEventListener("click",exportFlashcards),document.getElementById("showAcknowledgements").addEventListener("click",(e=>{e.stopPropagation();const t=document.getElementById("settings"),n=document.getElementById("acknowledgements");t.classList.add("hidden"),n.classList.remove("hidden"),n.classList.add("active")})),document.getElementById("backToSettings").addEventListener("click",(e=>{e.stopPropagation();const t=document.getElementById("settings"),n=document.getElementById("acknowledgements");n.classList.add("hidden"),n.classList.remove("active"),t.classList.remove("hidden"),t.classList.add("active")}))})),chrome.runtime.onMessage.addListener((e=>{"vocabUpdated"===e.action&&loadFlashcards()})),chrome.runtime.onMessage.addListener((e=>{"toggleFurigana"===e.action&&document.querySelectorAll("rt").forEach((t=>{t.style.display=e.visible?"block":"none"}))})),document.addEventListener("DOMContentLoaded",(()=>{loadFlashcards();const e=document.getElementById("showAcknowledgements"),t=document.getElementById("backToSettings"),n=document.getElementById("settings"),a=document.getElementById("acknowledgements");e&&t&&n&&a&&(e.addEventListener("click",(()=>{n.classList.add("hidden"),a.classList.remove("hidden")})),t.addEventListener("click",(()=>{a.classList.add("hidden"),n.classList.remove("hidden")})))}));